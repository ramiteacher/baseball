<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAMI KBO</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Sans KR', sans-serif;
        }
        
        body {
            background-color: #f0f7ff;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: #f0f7ff;
            color: white;
            text-align: center;
            padding: 10px 0;
            margin-top: 20px;
            margin-bottom: 0px;
            border-radius: 20px;
        }
        
        h1, h2, h3 {
            margin-bottom: 15px;
            font-family: 'Noto Sans KR', sans-serif;
        }
        p {
            margin-bottom: 15px;
            font-family: 'Roboto', sans-serif;
        }
        
        .tab-container {
            display: flex;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #ddd;
            border: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
            font-weight: bold;
            font-family: 'Noto Sans KR', sans-serif;
        }
        
        .tab.active {
            background-color: #fff;
            border-bottom: 3px solid #1a3a7e;
        }
        
        .content {
            display: none;
            background-color: #fff;
            padding: 20px;
            border-radius: 0 5px 5px 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .content.active {
            display: block;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            table-layout: fixed; /* 열 너비 고정 */
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd
            
        }
        
        th {
            background-color: #1a3a7e;
            color: white;
        }
        
        tr:hover {
            background-color: #f1f1f1;
        }
        
        .team-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        .team-results {
            margin-bottom: 30px;
        }

        .team-results h3 {
            display: flex;
            align-items: center;
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .team-results h3 img {
            margin-right: 10px;
        }
        .team-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            color: white;
            transition: all 0.3s ease;
        }
        
        .team-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.2);
        }
        .team-filter-btn {
            padding: 2px; /* 버튼 내부 여백 */
            margin: 8px; /* 버튼 간 간격 */
            
            border: none;
            background: none;
            cursor: pointer;
            display: inline-block;
        }
        .team-filter-btn:hover {
            transform: scale(1.1); /* 버튼 크기 확대 효과 */
            transition: transform 0.2s ease-in-out;
        }
        .team-emblem {
            width: 40px; /* 원하는 너비 */
            height: 40px; /* 원하는 높이 */
            margin-right: 10px; /* 텍스트와의 간격 */
            vertical-align: middle; /* 텍스트와 수직 정렬 */
        }
        
        .highlight-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            text-align: center; /* 텍스트 가로 정렬 */
            white-space: nowrap; /* 텍스트를 한 줄로 유지 */
        }
        
        .loading {
            text-align: center;
            padding: 20px;
        }

        /* --- 초소형 화면 --- */
        @media (max-width: 430px) {
            table {
                font-size: 11px;
            }

            th, td {
                padding: 2px 4px;
                font-size: 11px;
                text-align: center; /* 중앙 정렬 */
            }
            th {
                font-size:11px;
                text-align: center; /* 중앙 정렬 */
            }
            .team-emblem {
                width: 40px;
                height: 40px;
            }

            .team-buttons {
                grid-template-columns: repeat(2, 1fr);
                
            }
            .team-btn {
            padding: 3px 2px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            color: white;
            transition: all 0.3s ease;
        }
        }
    </style>
</head>
<body>
    <header>
        
        <img src="images/logo.png" alt="KBO Logo" style="width: 150px; height: auto; margin-bottom: 10px;" onclick="window.location.href='/'">
        
    </header>
    
    <div class="container">
        <div class="tab-container">
            <button class="tab active" onclick="openTab('standings')">순위</button>
            <button class="tab" onclick="openTab('results')">최근 결과</button>
            <button class="tab" onclick="openTab('teams')">팀 응원가</button>
        </div>
        
        <div id="standings" class="content active">
            <h2>KBO 리그 순위</h2>
            <div id="standings-table">
                <div class="loading">순위 정보를 불러오는 중...</div>
            </div>
        </div>
        
        <div id="results" class="content">
            <h2>최근 경기 결과</h2>
                <!-- 팀 선택 버튼 영역 추가 -->
            <div id="team-selector" style="text-align: center; margin-bottom: 20px;">
            </div>
            <div id="results-list">
                <div class="loading">경기 결과를 불러오는 중...</div>
            </div>
        </div>
        
        <div id="teams" class="content">
            <h2>KBO 팀 응원가</h2>
            <p>

                
            </p>
            <div class="team-buttons">
                <!-- 팀 버튼들이 여기에 추가됨 -->
            </div>
        </div>
    </div>

    <script>
        // KBO 팀 정보
        const kboTeams = [
        { name: 'SSG 랜더스', color: '#CE0E2D', cheerSong: 'https://www.youtube.com/watch?v=Ae5vJe0VSac', emblem: 'images/ssg.png' },
        { name: '키움 히어로즈', color: '#6F263D', cheerSong: 'https://www.youtube.com/watch?v=80HiZa_kD8A', emblem: 'images/kiwoom.png' },
        { name: 'LG 트윈스', color: '#C30452', cheerSong: 'https://www.youtube.com/watch?v=GC0rYa-jzss', emblem: 'images/lg.png' },
        { name: 'KT 위즈', color: '#000000', cheerSong: 'https://www.youtube.com/watch?v=g-epGphW8FU', emblem: 'images/kt.png' },
        { name: 'KIA 타이거즈', color: '#EA0029', cheerSong: 'https://www.youtube.com/watch?v=zxT6hgRCNVo', emblem: 'images/kia.png' },
        { name: 'NC 다이노스', color: '#315288', cheerSong: 'https://www.youtube.com/watch?v=Gl6jdPTrM14', emblem: 'images/nc.png' },
        { name: '삼성 라이온즈', color: '#0066B3', cheerSong: 'https://www.youtube.com/watch?v=1einbSNenqo', emblem: 'images/samsung.png' },
        { name: '롯데 자이언츠', color: '#002B70', cheerSong: 'https://www.youtube.com/watch?v=-sB8lMaqRdo', emblem: 'images/lotte.png' },
        { name: '두산 베어스', color: '#131230', cheerSong: 'https://www.youtube.com/watch?v=M4ZjtWK3UqI', emblem: 'images/doosan.png' },
        { name: '한화 이글스', color: '#FF6600', cheerSong: 'https://www.youtube.com/watch?v=6tFcBE_hRLU', emblem: 'images/hanwha.png' }
        ];

        // API URL (KBO 데이터 제공 URL로 수정 필요)
        const STANDINGS_API_URL = 'https://api.sports.daum.net/player/kbo/team/rank.json';
        const RESULTS_API_URL = 'https://api.sports.daum.net/player/kbo/schedule/games.json';

        // 페이지 로드시 실행
        document.addEventListener('DOMContentLoaded', function() {
            fetchLocalRankings(); // 로컬 JSON 파일에서 순위 데이터 가져오기
            fetchLocalResults(); // wanle.json에서 결과 데이터 가져오기
            createTeamButtons();
            addDateSelector(); // 날짜 선택 UI 추가
            createTeamEmblemButtons(); // 팀 엠블럼 버튼 생성
            fetchLocalResults(); // 경기 결과 가져오기
        });

        // 탭 기능
        function openTab(tabName) {
            const tabs = document.getElementsByClassName('tab');
            const contents = document.getElementsByClassName('content');
            
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
                contents[i].classList.remove('active');
            }
            
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`.tab[onclick="openTab('${tabName}')"]`).classList.add('active');
        }

        // KBO API에서 데이터 가져오기
        async function fetchKBOData() {
            try {
                await Promise.all([fetchStandings(), fetchResults()]);
            } catch (error) {
                console.error('데이터를 불러오는 중 오류가 발생했습니다:', error);
                document.getElementById('standings-table').innerHTML = '<p>순위 정보를 불러오는 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요.</p>';
                document.getElementById('results-list').innerHTML = '<p>경기 결과를 불러오는 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요.</p>';
            }
        }

        // 순위 데이터 가져오기 (네이버 스포츠 모바일)
        async function fetchStandings() {
            try {
                // CORS 프록시 서비스를 사용하여 네이버 스포츠 모바일 페이지 가져오기
                const corsProxy = 'https://cors-anywhere.herokuapp.com/';
                const naverStandingsUrl = 'https://m.sports.naver.com/kbaseball/record/index';
                
                const response = await fetch(corsProxy + naverStandingsUrl, {
                    method: 'GET',
                    headers: {
                        'Origin': window.location.origin
                    }
                });
                
                if (!response.ok) {
                    throw new Error('순위 데이터를 가져오는데 실패했습니다');
                }
                
                const html = await response.text();
                const standingsData = parseNaverMobileStandings(html);
                displayNaverStandings(standingsData);
            } catch (error) {
                console.error('순위 데이터 가져오기 오류:', error);
                // 네이버 스포츠 접근 실패시 기본 데이터로 폴백
                displayStandingsFallback();
            }
        }

        // 최근 경기 결과 가져오기 (네이버 스포츠 모바일)
        async function fetchResults(date) {
            try {
                // wanle.json 파일에서 데이터를 가져옴
                await fetchLocalResults(date);
            } catch (error) {
                console.error('경기 결과 데이터 가져오기 오류:', error);
                // 접근 실패시 기본 데이터로 폴백
                displayResultsFallback();
            }
        }
        
        // 네이버 스포츠 모바일 순위 페이지 파싱
        function parseNaverMobileStandings(html) {
            // HTML 파싱을 위한 임시 요소 생성
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            // 순위표 추출 (모바일 버전의 HTML 구조에 맞게 수정)
            const standingsTable = doc.querySelector('.record_table');
            const teams = [];
            
            if (standingsTable) {
                const rows = standingsTable.querySelectorAll('table > tbody > tr');
                
                rows.forEach(row => {
                    const columns = row.querySelectorAll('td');
                    if (columns.length > 0) {
                        teams.push({
                            rank: columns[0].textContent.trim(),
                            name: columns[1].textContent.trim(),
                            games: columns[2].textContent.trim(),
                            wins: columns[3].textContent.trim(),
                            losses: columns[4].textContent.trim(),
                            draws: columns[5].textContent.trim(),
                            winPct: columns[6].textContent.trim(),
                            gameBehind: columns[7].textContent.trim()
                        });
                    }
                });
            }
            
            return teams;
        }
        
        // 네이버 스포츠 모바일 경기 결과 페이지 파싱
        function parseNaverMobileResults(html) {
            // HTML 파싱을 위한 임시 요소 생성
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            // 경기 결과 추출 (모바일 버전의 HTML 구조에 맞게 수정)
            const scheduleTable = doc.querySelector('.sch_table');
            const games = [];
            
            if (scheduleTable) {
                const dateSection = scheduleTable.querySelector('.sch_date');
                const dateStr = dateSection ? dateSection.textContent.trim() : '';
                const gameRows = scheduleTable.querySelectorAll('.sch_list > li');
                
                gameRows.forEach(gameRow => {
                    // 경기 상태 확인 (종료된 경기만 추출)
                    const gameStatus = gameRow.querySelector('.state');
                    if (gameStatus && gameStatus.textContent.includes('종료')) {
                        const homeTeamEl = gameRow.querySelector('.home_team');
                        const awayTeamEl = gameRow.querySelector('.away_team');
                        const scoreEl = gameRow.querySelector('.score');
                        const venueEl = gameRow.querySelector('.place');
                        
                        if (homeTeamEl && awayTeamEl && scoreEl) {
                            const homeTeam = homeTeamEl.textContent.trim();
                            const awayTeam = awayTeamEl.textContent.trim();
                            const scoreText = scoreEl.textContent.trim();
                            const scoreMatch = scoreText.match(/(\d+)-(\d+)/);
                            const stadium = venueEl ? venueEl.textContent.trim() : '-';
                            
                            if (scoreMatch) {
                                games.push({
                                    date: dateStr,
                                    homeTeam: homeTeam,
                                    homeScore: scoreMatch[1],
                                    awayTeam: awayTeam,
                                    awayScore: scoreMatch[2],
                                    stadium: stadium,
                                    highlight: null
                                });
                            }
                        }
                    }
                });
            }
            
            return games;
        }

        // 네이버 스포츠 순위 페이지 파싱
        function parseNaverStandings(html) {
            // HTML 파싱을 위한 임시 요소 생성
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            // 순위표 추출
            const standingsTable = doc.querySelector('.tb_main');
            const teams = [];
            
            if (standingsTable) {
                const rows = standingsTable.querySelectorAll('tbody tr');
                
                rows.forEach(row => {
                    const columns = row.querySelectorAll('td');
                    if (columns.length > 0) {
                        teams.push({
                            rank: columns[0].textContent.trim(),
                            name: columns[1].textContent.trim(),
                            games: columns[2].textContent.trim(),
                            wins: columns[3].textContent.trim(),
                            losses: columns[4].textContent.trim(),
                            draws: columns[5].textContent.trim(),
                            winPct: columns[6].textContent.trim(),
                            gameBehind: columns[7].textContent.trim(),
                            last10: columns[12] ? columns[12].textContent.trim() : '-'
                        });
                    }
                });
            }
            
            return teams;
        }
        
        // 네이버 스포츠 경기 결과 페이지 파싱
        function parseNaverResults(html) {
            // HTML 파싱을 위한 임시 요소 생성
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            // 경기 결과 추출
            const scheduleTable = doc.querySelector('.tb_wrap');
            const games = [];
            
            if (scheduleTable) {
                const dateRows = scheduleTable.querySelectorAll('.tb_date');
                
                dateRows.forEach(dateRow => {
                    const dateStr = dateRow.textContent.trim();
                    const gameRows = dateRow.nextElementSibling.querySelectorAll('tr');
                    
                    gameRows.forEach(gameRow => {
                        const columns = gameRow.querySelectorAll('td');
                        if (columns.length >= 5) {
                            const homeTeam = columns[1].textContent.trim();
                            const score = columns[2].textContent.trim();
                            const awayTeam = columns[3].textContent.trim();
                            const stadium = columns[4].textContent.trim();
                            
                            // 스코어가 있는 경우만 추가 (경기가 진행된 경우)
                            if (score && score !== 'VS') {
                                const scoreArr = score.split(':');
                                games.push({
                                    date: dateStr,
                                    homeTeam: homeTeam,
                                    homeScore: scoreArr[0].trim(),
                                    awayTeam: awayTeam,
                                    awayScore: scoreArr[1].trim(),
                                    stadium: stadium,
                                    highlight: null // 네이버에서는 하이라이트 URL을 바로 가져오기 어려움
                                });
                            }
                        }
                    });
                });
            }
            
            return games;
        }
        
        // 네이버 순위 표시
        function displayNaverStandings(teams) {
            const standingsTable = document.getElementById('standings-table');
            
            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>순위</th>
                            <th>팀명</th>
                            <th>경기</th>
                            <th>승</th>
                            <th>패</th>
                            <th>무</th>
                            <th>승률</th>
                            <th>게임차</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            teams.forEach(team => {
                tableHTML += `
                    <tr>
                        <td>${team.rank}</td>
                        <td>${team.name}</td>
                        <td>${team.games}</td>
                        <td>${team.wins}</td>
                        <td>${team.losses}</td>
                        <td>${team.draws}</td>
                        <td>${team.winPct}</td>
                        <td>${team.gameBehind}</td>
                    </tr>
                `;
            });
            
            tableHTML += `
                    </tbody>
                </table>
                <p><small>출처: 네이버 스포츠 | 최종 업데이트: ${new Date().toLocaleString('ko-KR')}</small></p>
            `;
            
            standingsTable.innerHTML = tableHTML;
        }
        
        // 네이버 경기 결과 표시
        function displayNaverResults(games) {
            const resultsList = document.getElementById('results-list');
            
            let resultsHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>날짜</th>
                            <th>홈팀</th>
                            <th>점수</th>
                            <th>원정팀</th>
                            <th>구장</th>
                            <th>하이라이트</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            games.forEach(game => {
                resultsHTML += `
                    <tr>
                        <td>${game.date}</td>
                        <td>${game.homeTeam}</td>
                        <td>${game.homeScore} : ${game.awayScore}</td>
                        <td>${game.awayTeam}</td>
                        <td>${game.stadium || '-'}</td>
                        <td>
                            <button class="highlight-btn" onclick="window.open('https://sports.news.naver.com/kbaseball/vod/index?category=kbo', '_blank')">
                                하이라이트 검색
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            resultsHTML += `
                    </tbody>
                </table>
                <p><small>출처: 네이버 스포츠 | 최종 업데이트: ${new Date().toLocaleString('ko-KR')}</small></p>
            `;
            
            resultsList.innerHTML = resultsHTML;
        }

        // 순위 표시 (API 데이터 사용)
        function displayStandings(data) {
            const standingsTable = document.getElementById('standings-table');
            
            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>순위</th>
                            <th>팀명</th>
                            <th>승</th>
                            <th>패</th>
                            <th>무</th>
                            <th>승률</th>
                            <th>게임차</th>
                            <th>최근 10경기</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            // API 응답 형식에 맞게 데이터 처리
            const teams = data.teams || [];
            teams.forEach(team => {
                tableHTML += `
                    <tr>
                        <td>${team.rank}</td>
                        <td>${team.name}</td>
                        <td>${team.wins}</td>
                        <td>${team.losses}</td>
                        <td>${team.draws}</td>
                        <td>${team.winPct}</td>
                        <td>${team.gameBehind || '-'}</td>
                        <td>${team.last10 || '-'}</td>
                    </tr>
                `;
            });
            
            tableHTML += `
                    </tbody>
                </table>
                <p><small>최종 업데이트: ${new Date().toLocaleString('ko-KR')}</small></p>
            `;
            
            standingsTable.innerHTML = tableHTML;
        }
            function displayResultsByTeam(games) {
            const resultsList = document.getElementById('results-list');
            const teams = kboTeams.map(team => ({
                name: team.name,
                emblem: team.emblem,
                games: games.filter(game => game.home === team.name || game.away === team.name)
            }));
        
            let html = '';
        
            teams.forEach(team => {
                if (team.games.length > 0) {
                    html += `
                        <div class="team-results">
                            <h3>
                                <img src="${team.emblem}" alt="${team.name}" class="team-emblem">
                                ${team.name}
                            </h3>
                            <table>
                                <thead>
                                    <tr>
                                        <th>날짜</th>
                                        <th>홈팀</th>
                                        <th>점수</th>
                                        <th>원정팀</th>
                                        <th>하이라이트</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
        
                    team.games.forEach(game => {
                        const homeTeamData = kboTeams.find(t => t.name === game.home);
                        const awayTeamData = kboTeams.find(t => t.name === game.away);
                        const homeEmblem = homeTeamData ? `<img src="${homeTeamData.emblem}" alt="${game.home}" class="team-emblem">` : '';
                        const awayEmblem = awayTeamData ? `<img src="${awayTeamData.emblem}" alt="${game.away}" class="team-emblem">` : '';
        
                        html += `
                            <tr>
                                <td>${game.date}</td>
                                <td>${homeEmblem}${game.home}</td>
                                <td>${game.score}</td>
                                <td>${awayEmblem}${game.away}</td>
                                <td>
                                    <button class="highlight-btn" onclick="fetchYouTubeHighlight('${game.home} vs ${game.away} 하이라이트', '${game.date}')">영상</button>
                                </td>
                            </tr>
                        `;
                    });
        
                    html += `
                                </tbody>
                            </table>
                        </div>
                    `;
                }
            });
        
            resultsList.innerHTML = html;
        }
        // 순위 표시 폴백 (API 실패시)
        function displayStandingsFallback() {
            const standingsTable = document.getElementById('standings-table');
            
            // 현재 날짜 기준의 임시 데이터 생성
            const currentYear = new Date().getFullYear();
            const teams = kboTeams.map((team, index) => {
                const wins = Math.floor(Math.random() * 40) + 40;
                const losses = Math.floor(Math.random() * 30) + 20;
                const draws = Math.floor(Math.random() * 3);
                const winPct = (wins / (wins + losses)).toFixed(3).substring(1);
                
                return {
                    rank: index + 1,
                    team: team.name,
                    wins,
                    losses,
                    draws,
                    winPct
                };
            });
            
            // 승률 기준으로 정렬
            teams.sort((a, b) => parseFloat(b.winPct) - parseFloat(a.winPct));
            
            // 순위 재할당
            teams.forEach((team, index) => {
                team.rank = index + 1;
            });
            
            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>순위</th>
                            <th>팀명</th>
                            <th>승</th>
                            <th>패</th>
                            <th>무</th>
                            <th>승률</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            teams.forEach(team => {
                tableHTML += `
                    <tr>
                        <td>${team.rank}</td>
                        <td>${team.team}</td>
                        <td>${team.wins}</td>
                        <td>${team.losses}</td>
                        <td>${team.draws}</td>
                        <td>${team.winPct}</td>
                    </tr>
                `;
            });
            
            tableHTML += `
                    </tbody>
                </table>
                <p><small>* API 연결 실패로 임시 데이터가 표시됩니다.</small></p>
            `;
            
            standingsTable.innerHTML = tableHTML;
        }

        // 경기 결과 표시 (API 데이터 사용)
        function displayResults(data) {
            const resultsList = document.getElementById('results-list');
            
            let resultsHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>날짜</th>
                            <th>홈팀</th>
                            <th>점수</th>
                            <th>원정팀</th>
                            <th>구장</th>
                            <th>하이라이트</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            // API 응답 형식에 맞게 데이터 처리
            const games = data.games || [];
            games.forEach(game => {
                resultsHTML += `
                    <tr>
                        <td>${game.date}</td>
                        <td>${game.homeTeam}</td>
                        <td>${game.homeScore !== undefined ? game.homeScore : '-'} : ${game.awayScore !== undefined ? game.awayScore : '-'}</td>
                        <td>${game.awayTeam}</td>
                        <td>${game.stadium || '-'}</td>
                        <td>
                            ${game.highlight ? 
                            `<button class="highlight-btn" onclick="window.open('${game.highlight}', '_blank')">영상</button>` : 
                            '미제공'}
                        </td>
                    </tr>
                `;
            });
            
            resultsHTML += `
                    </tbody>
                </table>
                <p><small>최종 업데이트: ${new Date().toLocaleString('ko-KR')}</small></p>
            `;
            
            resultsList.innerHTML = resultsHTML;
        }

        // 경기 결과 표시 폴백 (API 실패시)
        function displayResultsFallback() {
            const resultsList = document.getElementById('results-list');
            
            // 현재 날짜 기준의 임시 데이터 생성
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            const formatDate = (date) => {
                return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
            };
            
            const todayStr = formatDate(today);
            const yesterdayStr = formatDate(yesterday);
            
            const generateRandomGames = (date) => {
                return kboTeams.slice(0, 10).map((team, index) => {
                    if (index % 2 === 1) return null; // 홀수 인덱스 건너뛰기
                    
                    const homeScore = Math.floor(Math.random() * 10);
                    const awayScore = Math.floor(Math.random() * 10);
                    
                    return {
                        date: date,
                        homeTeam: team.name,
                        homeScore: homeScore,
                        awayTeam: kboTeams[(index + 1) % 10].name,
                        awayScore: awayScore,
                        highlight: 'https://www.youtube.com/watch?v=example' + index
                    };
                }).filter(game => game !== null);
            };
            
            const games = [
                ...generateRandomGames(todayStr),
                ...generateRandomGames(yesterdayStr)
            ];
            
            let resultsHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>날짜</th>
                            <th>홈팀</th>
                            <th>점수</th>
                            <th>원정팀</th>
                            <th>하이라이트</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            games.forEach(game => {
                resultsHTML += `
                    <tr>
                        <td>${game.date}</td>
                        <td>${game.homeTeam}</td>
                        <td>${game.homeScore} : ${game.awayScore}</td>
                        <td>${game.awayTeam}</td>
                        <td><button class="highlight-btn" onclick="window.open('${game.highlight}', '_blank')">영상</button></td>
                    </tr>
                `;
            });
            
            resultsHTML += `
                    </tbody>
                </table>
                <p><small>* API 연결 실패로 임시 데이터가 표시됩니다.</small></p>
            `;
            
            resultsList.innerHTML = resultsHTML;
        }

        // 팀 버튼 생성
        function createTeamButtons() {
            const teamButtonsContainer = document.querySelector('.team-buttons');
            
            kboTeams.forEach(team => {
                const button = document.createElement('button');
                button.className = 'team-btn';
                button.innerHTML = `<img src="${team.emblem}" alt="${team.name}" class="team-emblem"> ${team.name}`;
                button.style.backgroundColor = team.color;
                button.onclick = function() {
                    window.open(team.cheerSong, '_blank');
                };
                
                teamButtonsContainer.appendChild(button);
            });
        }

        // 결과 탭에 날짜 선택 UI 추가
        function addDateSelector() {
            const resultsTab = document.getElementById('results');
            const resultsHeading = resultsTab.querySelector('h2');
            
            // 오늘, 어제, 1주일 전 날짜 계산
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            const twoDaysAgo = new Date(today);
            twoDaysAgo.setDate(twoDaysAgo.getDate() - 2);
            
            // 날짜 형식 변환 (YYYY-MM-DD)
            const formatDate = (date) => {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            };
            
            const todayStr = formatDate(today);
            const yesterdayStr = formatDate(yesterday);
            const twoDaysAgoStr = formatDate(twoDaysAgo);
            
            // 날짜 선택 UI 생성
            const dateSelector = document.createElement('div');
            dateSelector.className = 'date-selector';
            dateSelector.innerHTML = `
                <style>
                    .date-selector {
                        margin-bottom: 20px;
                        display: flex;
                        flex-wrap: wrap;
                        gap: 10px;
                    }
                    .date-btn {
                        padding: 8px 15px;
                        background-color: #1a3a7e;
                        color: white;
                        border: none;
                        border-radius: 4px;
                        cursor: pointer;
                        font-weight: bold;
                    }
                    .date-btn:hover {
                        background-color: #2c4e9e;
                    }
                    .date-btn.active {
                        background-color: #ff6600;
                    }
                    .date-input {
                        padding: 8px;
                        border: 1px solid #ddd;
                        border-radius: 4px;
                    }
                </style>
                <button class="date-btn" data-date="${todayStr}">오늘 (${todayStr})</button>
                <button class="date-btn" data-date="${yesterdayStr}">어제 (${yesterdayStr})</button>
                <button class="date-btn" data-date="${twoDaysAgoStr}">그저께 (${twoDaysAgoStr})</button>
                <button class="date-btn" data-date="all">전체 보기</button>
                <input type="date" class="date-input" value="${todayStr}" max="${todayStr}">
                <button class="date-btn" id="date-search-btn">조회</button>
            `;
            
            // 날짜 선택 UI 삽입
            resultsHeading.insertAdjacentElement('afterend', dateSelector);
            
            // 날짜 버튼 클릭 이벤트 처리
            const dateButtons = dateSelector.querySelectorAll('.date-btn');
            dateButtons.forEach(button => {
                if (button.id !== 'date-search-btn') {
                    button.addEventListener('click', () => {
                        // 모든 버튼에서 active 클래스 제거
                        dateButtons.forEach(btn => btn.classList.remove('active'));
                        // 클릭된 버튼에 active 클래스 추가
                        button.classList.add('active');
                        
                        const selectedDate = button.getAttribute('data-date');
                        if (selectedDate !== 'all') {
                            document.querySelector('.date-input').value = selectedDate;
                        }
                        fetchLocalResults(selectedDate);
                    });
                }
            });
            
            // 날짜 직접 입력 후 조회 버튼 클릭 이벤트 처리
            const searchBtn = dateSelector.querySelector('#date-search-btn');
            searchBtn.addEventListener('click', () => {
                // 모든 버튼에서 active 클래스 제거
                dateButtons.forEach(btn => btn.classList.remove('active'));
                
                const selectedDate = dateSelector.querySelector('.date-input').value;
                fetchLocalResults(selectedDate);
            });
            
            // 페이지 로드시 오늘 날짜 버튼 활성화
            dateSelector.querySelector(`.date-btn[data-date="${todayStr}"]`).classList.add('active');
        }

        // 로컬 JSON 파일에서 순위 데이터 가져오기
        async function fetchLocalRankings() {
            try {
                const response = await fetch('./rank.json');
                if (!response.ok) {
                    throw new Error('순위 데이터를 가져오는데 실패했습니다');
                }
                
                const data = await response.json();
                displayLocalRankings(data);
            } catch (error) {
                console.error('순위 데이터 가져오기 오류:', error);
                displayStandingsFallback(); // JSON 파일 접근 실패시 기본 데이터로 폴백
            }
        }
        
        function displayLocalRankings(data) {
            const standingsTable = document.getElementById('standings-table');
            
            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>순위</th>
                            <th>팀명</th>
                            <th>경기</th>
                            <th>승</th>
                            <th>패</th>
                            <th>무</th>
                            <th>승률</th>
                            <th>게임차</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            const teams = data.rankings || [];
            teams.forEach(team => {
                // 팀 이름 매칭
                const teamData = kboTeams.find(t => t.name.includes(team.team) || team.team.includes(t.name));
                const emblem = teamData ? `<img src="${teamData.emblem}" alt="${team.team}" class="team-emblem">` : '';
                
                tableHTML += `
                    <tr>
                        <td>${team.rank}</td>
                        <td>${emblem}${team.team}</td>
                        <td>${team.games}</td>
                        <td>${team.win}</td>
                        <td>${team.lose}</td>
                        <td>${team.draw}</td>
                        <td>${team.win_rate.toFixed(3)}</td>
                        <td>${team.games_behind}</td>
                    </tr>
                `;
            });
            
            tableHTML += `
                    </tbody>
                </table>
                <p><small>최종 업데이트: ${data.last_updated || new Date().toLocaleString('ko-KR')}</small></p>
            `;
            
            standingsTable.innerHTML = tableHTML;
        }

        // 로컬 JSON 파일에서 결과 데이터 가져오기
        async function fetchLocalResults(selectedDate) {
            try {
                // wanle.json이 동일한 폴더에 있는지 확인하기 위해 경로 출력
                console.log("현재 파일 경로에서 wanle.json 가져오기 시도");
                
                // 여러 경로를 시도
                let response;
                try {
                    response = await fetch('./wanle.json');
                    if (!response.ok) throw new Error("기본 경로에서 파일을 찾을 수 없습니다");
                } catch (err) {
                    console.log("기본 경로 실패, 절대 경로 시도");
                    try {
                        response = await fetch('/wanle.json');
                        if (!response.ok) throw new Error("루트 경로에서 파일을 찾을 수 없습니다");
                    } catch (err2) {
                        console.log("절대 경로 실패, 전체 경로 시도");
                        response = await fetch('c:/Users/USER/Documents/카카오톡 받은 파일/순위/wanle.json');
                        if (!response.ok) throw new Error("전체 경로에서 파일을 찾을 수 없습니다");
                    }
                }
                
                // 대안 2: 파일을 가져올 수 없는 경우 하드코딩된 데이터 사용
                if (!response.ok) {
                    console.warn("JSON 파일을 가져올 수 없어 하드코딩된 데이터를 사용합니다");
                    return useHardcodedData(selectedDate);
                }
                
                // JSON 파싱
                const games = await response.json();
                const resultsList = document.getElementById('results-list');
                resultsList.dataset.games = JSON.stringify(games); // 경기 데이터를 저장
                displayFilteredResults(games); // 전체 경기 결과 표시
                
                // 날짜별 필터링 (selectedDate가 있는 경우)
                let filteredGames = games;
                if (selectedDate && selectedDate !== 'all') {
                    filteredGames = games.filter(game => game.date === selectedDate);
                    
                    if (filteredGames.length === 0) {
                        const resultsList = document.getElementById('results-list');
                        resultsList.innerHTML = `
                            <div class="no-games-message" style="text-align: center; padding: 30px;">
                                <p>선택하신 날짜(${selectedDate})에 경기 결과가 없습니다.</p>
                                <button class="date-btn" style="margin-top: 15px; padding: 8px 15px; background-color: #1a3a7e; color: white; border: none; border-radius: 4px; cursor: pointer;" 
                                        onclick="fetchLocalResults('all')">모든 경기 보기</button>
                            </div>
                        `;
                        return;
                    }
                }
                
                displayLocalResults(filteredGames);
                
            } catch (error) {
                console.error('경기 결과 데이터 가져오기 오류:', error);
                // 최후의 수단: 파일을 직접 내장
                useHardcodedData(selectedDate);
            }
        }

        // 하드코딩된 wanle.json 데이터를 사용
        function useHardcodedData(selectedDate) {
            // wanle.json 파일의 내용을 직접 자바스크립트 객체로 정의
            const gamesData = [
                {
                  "date": "2025-03-30",
                  "home": "두산",
                  "away": "삼성",
                  "score": "3 : 2",
                  "highlight": ""
                },
                {
                  "date": "2025-03-30",
                  "home": "롯데",
                  "away": "KT",
                  "score": "4 : 4",
                  "highlight": ""
                },
                {
                  "date": "2025-03-30",
                  "home": "키움",
                  "away": "SSG",
                  "score": "8 : 2",
                  "highlight": ""
                },
                {
                  "date": "2025-03-30",
                  "home": "한화",
                  "away": "KIA",
                  "score": "5 : 3",
                  "highlight": ""
                },
                {
                  "date": "2025-03-29",
                  "home": "키움",
                  "away": "SSG",
                  "score": "1 : 3",
                  "highlight": ""
                },
                {
                  "date": "2025-03-29",
                  "home": "한화",
                  "away": "KIA",
                  "score": "4 : 5",
                  "highlight": ""
                },
                {
                  "date": "2025-03-29",
                  "home": "두산",
                  "away": "삼성",
                  "score": "13 : 2",
                  "highlight": ""
                },
                {
                  "date": "2025-03-29",
                  "home": "롯데",
                  "away": "KT",
                  "score": "1 : 3",
                  "highlight": ""
                },
                {
                  "date": "2025-03-29",
                  "home": "NC",
                  "away": "LG",
                  "score": "14 : 4",
                  "highlight": ""
                },
                {
                  "date": "2025-03-28",
                  "home": "두산",
                  "away": "삼성",
                  "score": "0 : 2",
                  "highlight": ""
                },
                {
                  "date": "2025-03-28",
                  "home": "롯데",
                  "away": "KT",
                  "score": "2 : 0",
                  "highlight": ""
                },
                {
                  "date": "2025-03-28",
                  "home": "NC",
                  "away": "LG",
                  "score": "8 : 4",
                  "highlight": ""
                },
                {
                  "date": "2025-03-28",
                  "home": "키움",
                  "away": "SSG",
                  "score": "3 : 9",
                  "highlight": ""
                },
                {
                  "date": "2025-03-28",
                  "home": "한화",
                  "away": "KIA",
                  "score": "2 : 7",
                  "highlight": ""
                },
                {
                  "date": "2025-03-27",
                  "home": "LG",
                  "away": "한화",
                  "score": "1 : 2",
                  "highlight": ""
                }
            ];
            
            // 날짜별 필터링
            let filteredGames = gamesData;
            if (selectedDate && selectedDate !== 'all') {
                filteredGames = gamesData.filter(game => game.date === selectedDate);
                
                if (filteredGames.length === 0) {
                    const resultsList = document.getElementById('results-list');
                    resultsList.innerHTML = `
                        <div class="no-games-message" style="text-align: center; padding: 30px;">
                            <p>선택하신 날짜(${selectedDate})에 경기 결과가 없습니다.</p>
                            <button class="date-btn" style="margin-top: 15px; padding: 8px 15px; background-color: #1a3a7e; color: white; border: none; border-radius: 4px; cursor: pointer;" 
                                    onclick="useHardcodedData('all')">모든 경기 보기</button>
                        </div>
                    `;
                    return;
                }
            }
            
            displayLocalResults(filteredGames);
        }

        // 팀 엠블럼 버튼 생성
        function createTeamEmblemButtons() {
            const teamSelector = document.getElementById('team-selector');



            // 각 팀 엠블럼 버튼 추가
            kboTeams.forEach(team => {
                const button = document.createElement('button');
                button.className = 'team-filter-btn';
                button.dataset.team = team.name;
                button.style.border = 'none';
                button.style.background = 'none';
                button.style.cursor = 'pointer';
                button.innerHTML = `<img src="${team.emblem}" alt="${team.name}" class="team-emblem" title="${team.name}">`;
                button.onclick = () => filterResultsByTeam(team.name);
                teamSelector.appendChild(button);
            });
        }

        // 팀별 경기 결과 필터링
        function filterResultsByTeam(teamName) {
            const resultsList = document.getElementById('results-list');
            const allGames = JSON.parse(resultsList.dataset.games || '[]'); // 저장된 경기 데이터를 가져옴
        
            // 팀 이름 매핑 (JSON 데이터의 팀 이름 -> kboTeams 배열의 팀 이름)
            const teamMapping = kboTeams.reduce((map, team) => {
                map[team.name] = team.name; // 정확한 이름 매핑
                map[team.name.split(' ')[0]] = team.name; // 예: "두산" -> "두산 베어스"
                return map;
            }, {});
        
            let filteredGames = allGames;
        
            if (teamName !== 'all') {
                filteredGames = allGames.filter(game => {
                    const homeMatch = teamMapping[game.home] === teamName;
                    const awayMatch = teamMapping[game.away] === teamName;
                    return homeMatch || awayMatch;
                });
            }
        
            displayFilteredResults(filteredGames);
        }
        // 필터링된 경기 결과 표시
        function displayFilteredResults(games) {
            const resultsList = document.getElementById('results-list');
        
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>날짜</th>
                            <th>홈팀</th>
                            <th>점수</th>
                            <th>원정팀</th>
                            <th>하이라이트</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
        
            games.forEach(game => {
                // 팀 이름 매칭
                const homeTeamData = kboTeams.find(t => t.name.includes(game.home) || game.home.includes(t.name));
                const awayTeamData = kboTeams.find(t => t.name.includes(game.away) || game.away.includes(t.name));
                const homeEmblem = homeTeamData ? `<img src="${homeTeamData.emblem}" alt="${game.home}" class="team-emblem">` : '';
                const awayEmblem = awayTeamData ? `<img src="${awayTeamData.emblem}" alt="${game.away}" class="team-emblem">` : '';
        
                html += `
                    <tr>
                        <td>${game.date}</td>
                        <td>${homeEmblem} ${game.home}</td>
                        <td>${game.score}</td>
                        <td>${awayEmblem} ${game.away}</td>
                        <td>
                            <button class="highlight-btn" onclick="fetchYouTubeHighlight('${game.home} vs ${game.away} 하이라이트', '${game.date}')">영상</button>
                        </td>
                    </tr>
                `;
            });
        
            html += `
                    </tbody>
                </table>
            `;
        
            resultsList.innerHTML = html;
        }
    </script>

<script>
    // 여러 API 키를 배열로 저장
    const ENCODED_API_KEYS = [
        'QUl6YVN5QlVkWjVWMjFGZjRKcDBnTWNlc1NUZXNITTFmc3pFZ1Aw', // 기존 키
        'QUl6YVN5QjlMVzBpZXNxcVl6WkJzWWJsX184VlhhaV9IdW9lc2lJ', // 새 키 1
        'QUl6YVN5QUlsTFpyb3IyallXUHRBaV8tQXRoV1ctQThTcGVySU1F'  // 새 키 2
    ];

    // 디코딩된 API 키를 저장
    const API_KEYS = ENCODED_API_KEYS.map(key => atob(key));

    // 현재 사용할 API 키의 인덱스
    let currentApiKeyIndex = 0;

    // 현재 API 키를 반환하는 함수
    function getCurrentApiKey() {
        return API_KEYS[currentApiKeyIndex];
    }

    // 다음 API 키로 순환하는 함수
    function rotateApiKey() {
        currentApiKeyIndex = (currentApiKeyIndex + 1) % API_KEYS.length;
        console.log(`🔄 API 키 변경: ${getCurrentApiKey()}`);
    }

    // YouTube 하이라이트 검색 함수
    async function fetchYouTubeHighlight(query, gameDate) {
        try {
            console.log(`YouTube 검색 쿼리: ${query}`);
            console.log(`경기 날짜: ${gameDate}`);

            // 날짜를 "4월 2일" 형식으로 변환
            const dateObj = new Date(gameDate);
            const formattedDate = `${dateObj.getMonth() + 1}월 ${dateObj.getDate()}일`;
            console.log(`변환된 날짜 형식: ${formattedDate}`);

            // 날짜 범위 설정 (해당 날짜의 시작과 끝)
            const startOfDay = new Date(gameDate);
            startOfDay.setHours(0, 0, 0, 0); // 자정
            const endOfDay = new Date(gameDate);
            endOfDay.setHours(23, 59, 59, 999); // 하루의 끝

            const publishedAfter = startOfDay.toISOString();
            const publishedBefore = endOfDay.toISOString();

            console.log(`검색 날짜 범위: ${publishedAfter} ~ ${publishedBefore}`);

            // YouTube API 요청
            const response = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=1&videoDuration=medium&q=${encodeURIComponent(query)}&publishedAfter=${publishedAfter}&publishedBefore=${publishedBefore}&key=${getCurrentApiKey()}`);
            if (!response.ok) {
                // API 키가 막힌 경우 다음 키로 순환
                if (response.status === 403) {
                    console.warn('❌ API 키 할당량 초과. 다음 키로 전환합니다.');
                    rotateApiKey();
                    return fetchYouTubeHighlight(query, gameDate); // 재시도
                }
                throw new Error(`YouTube API 요청 실패: ${response.status} ${response.statusText}`);
            }

            const data = await response.json();
            console.log('YouTube API 응답 데이터:', data);

            if (data.items && data.items.length > 0) {
                // 첫 번째 검색 결과의 동영상 URL 열기
                const videoId = data.items[0].id.videoId;
                const videoUrl = `https://www.youtube.com/watch?v=${videoId}`;
                console.log(`동영상 URL: ${videoUrl}`);
                window.open(videoUrl, '_blank');
            } else {
                // 검색 결과가 없을 경우 YouTube 검색 페이지로 이동
                alert('해당 날짜에 업로드된 관련 동영상을 찾을 수 없습니다. YouTube 검색 페이지로 이동합니다.');
                window.open(`https://www.youtube.com/results?search_query=${encodeURIComponent(query)}`, '_blank');
            }
        } catch (error) {
            console.error('YouTube API 오류:', error);
            alert('YouTube 동영상을 가져오는 중 오류가 발생했습니다. 콘솔 로그를 확인하세요.');
        }
    }

    function displayLocalResults(games) {
        const resultsList = document.getElementById('results-list');

        let html = `
            <table>
                <thead>
                    <tr>
                        <th>날짜</th>
                        <th>홈팀</th>
                        <th>점수</th>
                        <th>원정팀</th>
                        <th>하이라이트</th>
                    </tr>
                </thead>
                <tbody>
        `;

        games.forEach(game => {
            // 팀 이름 매칭
            const homeTeamData = kboTeams.find(t => t.name.includes(game.home) || game.home.includes(t.name));
            const awayTeamData = kboTeams.find(t => t.name.includes(game.away) || game.away.includes(t.name));
            const homeEmblem = homeTeamData ? `<img src="${homeTeamData.emblem}" alt="${game.home}" class="team-emblem">` : '';
            const awayEmblem = awayTeamData ? `<img src="${awayTeamData.emblem}" alt="${game.away}" class="team-emblem">` : '';

            html += `
                <tr>
                    <td>${game.date}</td>
                    <td>${homeEmblem}${game.home}</td>
                    <td>${game.score}</td>
                    <td>${awayEmblem}${game.away}</td>
                    <td>
                        <button class="highlight-btn" onclick="fetchYouTubeHighlight('${game.home} vs ${game.away} 하이라이트', '${game.date}')">영상</button>
                    </td>
                </tr>
            `;
        });

        html += `
                </tbody>
            </table>
        `;

        resultsList.innerHTML = html;
    }

console.log(`YouTube 검색 쿼리: ${query}`);
</script>

</body>
</html>
